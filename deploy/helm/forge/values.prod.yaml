# Production overrides for FORGE
# Use with: helm install forge ./deploy/helm/forge -f deploy/helm/forge/values.prod.yaml

image:
  registry: cgr.dev/chainguard-private
  pullPolicy: Always
  pullSecrets:
    - name: chainguard-registry

api:
  replicas: 3
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilization: 70
    targetMemoryUtilization: 80

worker:
  replicas: 5
  autoscaling:
    enabled: true
    minReplicas: 5
    maxReplicas: 20
    targetCPUUtilization: 70

ui:
  replicas: 3

redis:
  external:
    enabled: true
    url: "redis://prod-redis.database.svc.cluster.local:6379"
  # Disable in-cluster Redis for production
  resources:
    requests:
      cpu: 0
      memory: 0

ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
  hosts:
    - host: forge.chainguard.dev
      paths:
        - path: /api
          pathType: Prefix
          service: api
        - path: /
          pathType: Prefix
          service: ui
  tls:
    - secretName: forge-prod-tls
      hosts:
        - forge.chainguard.dev

env:
  FORGE_REDIS_URL: "redis://prod-redis.database.svc.cluster.local:6379"
  FORGE_CORS_ORIGINS: '["https://forge.chainguard.dev"]'
  FORGE_JOB_TIMEOUT_SECONDS: "900"
  FORGE_JOB_RESULT_TTL_SECONDS: "7200"

# Production pod disruption budgets
podDisruptionBudget:
  api:
    enabled: true
    minAvailable: 1
  worker:
    enabled: true
    minAvailable: 2
  ui:
    enabled: true
    minAvailable: 1
